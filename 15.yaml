external-controller: 0.0.0.0:9090
external-ui: ui
external-ui-url: https://github.com/Zephyruso/zashboard/releases/latest/download/dist.zip
secret: 
unified-delay: true
log-level: info
ipv6: false
find-process-mode: off
tcp-concurrent: true
keep-alive-idle: 60
keep-alive-interval: 30

profile:
  store-selected: true
  store-fake-ip: false

# –ü–†–û–í–ê–ô–î–ï–†–´ –ü–†–ê–í–ò–õ
rule-providers:
  meta_ips:
    type: http
    behavior: ipcidr
    url: "https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/facebook.yaml"
    path: ./ruleset/meta_ips.yaml
    interval: 86400
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 600
    download-timeout: 30

  telegram_ips:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Telegram/Telegram.yaml"
    path: ./ruleset/telegram.yaml
    interval: 86400
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 600
    download-timeout: 30

  youtube_ips:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/YouTube/YouTube.yaml"
    path: ./ruleset/youtube.yaml
    interval: 43200
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 600
    download-timeout: 30

# DNS –ù–ê–°–¢–†–û–ô–ö–ò (—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Å MikroTik)
dns:
  enable: true
  use-system-hosts: true
  
  # –û—Å–Ω–æ–≤–Ω—ã–µ DNS —Å–µ—Ä–≤–µ—Ä—ã (—Ç–µ –∂–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ MikroTik)
  nameserver:
    - 'tls://1.1.1.1'  # Cloudflare
    - 'tls://8.8.8.8'  # Google
    - 'system'         # –°–∏—Å—Ç–µ–º–Ω—ã–µ DNS –∏–∑ MikroTik
  
  # Fallback –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
  fallback:
    - 'https://1.1.1.1/dns-query'  # Cloudflare DoH
    - 'tls://1.0.0.1'
  
  fallback-filter:
    geoip: true
    geoip-code: RU  # –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à—É —Å—Ç—Ä–∞–Ω—É
    ipcidr:
      - 0.0.0.0/8
      - 10.0.0.0/8
      - 100.64.0.0/10
      - 127.0.0.0/8
      - 169.254.0.0/16
      - 172.16.0.0/12
      - 192.0.0.0/24
      - 192.0.2.0/24
      - 192.168.0.0/16
      - 198.18.0.0/15
      - 198.51.100.0/24
      - 203.0.113.0/24
      - 224.0.0.0/4
      - 240.0.0.0/4
      - 255.255.255.255/32

proxy-providers:
  AWG:
    type: file
    path: "/etc/mihomo/awg.yaml"
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true
      expected-status: 204
  SUB1_TEST:
    type: http
    url: "—Ç–∞—Ä–∞–º –ø–∞—Ä–∞–º 1"
    interval: 3600
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true
      expected-status: 204
    header:
      x-hwid:
      - db5bc658993049afba8e3881780cd4f6
  SUB2_TEST:
    type: http
    url: "—Ç–∞—Ä–∞–º –ø–∞—Ä–∞–º 2"
    interval: 3600
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true
      expected-status: 204
    header:
      x-hwid:
      - db5bc658993049afba8e3881780cd4f6


# –ü–†–û–ö–°–ò-–ì–†–£–ü–ü–´
proxy-groups:
  # –û—Å–Ω–æ–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞
  - name: üöÄ AUTO-SELECT
    type: url-test
    use:
      - AWG
      - SUB1_TEST
      - SUB2_TEST

    url: https://www.gstatic.com/generate_204
    interval: 300
    tolerance: 150
    lazy: true
  
  # –°–µ—Ä–≤–∏—Å–Ω—ã–µ –≥—Ä—É–ø–ø—ã (–¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –≤ UI)
  - name: üü¢ WhatsApp
    type: select
    proxies:
      - üöÄ AUTO-SELECT
      - DIRECT
  
  - name: üì∏ Instagram
    type: select
    proxies:
      - üöÄ AUTO-SELECT
      - DIRECT
  
  - name: üìÆ Telegram
    type: select
    proxies:
      - üöÄ AUTO-SELECT
      - DIRECT
  
  - name: ‚ñ∂Ô∏è YouTube
    type: select
    proxies:
      - üöÄ AUTO-SELECT
      - DIRECT
  
  # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∞
  - name: QUIC UDP 443
    type: select
    proxies:
      - PASS
      - REJECT

# LISTENERS (–í–ê–ñ–ù–û: TUN –±–µ–∑ –∞–≤—Ç–æ-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏!)
listeners:
  - name: mixed-in
    type: mixed
    port: 1080
  
  # TUN –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ë–ï–ó –∞–≤—Ç–æ-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
  - name: tun-in
    type: tun
    stack: system
    auto-detect-interface: true
    auto-route: true          # –û–¢–ö–õ–Æ–ß–ï–ù–û!
    auto-redirect: true       # –û–¢–ö–õ–Æ–ß–ï–ù–û!
    inet4-address:
      - 198.19.0.1/30

# –ü–†–ê–í–ò–õ–ê –ú–ê–†–®–†–£–¢–ò–ó–ê–¶–ò–ò
rules:
  # 1. –õ–æ–∫–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
  - IP-CIDR,192.168.0.0/16,DIRECT,no-resolve
  - IP-CIDR,10.0.0.0/8,DIRECT,no-resolve
  - IP-CIDR,172.16.0.0/12,DIRECT,no-resolve
  
  # 2. –°–µ—Ç–µ–≤—ã–µ –∞–¥—Ä–µ—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ MikroTik
  - IP-CIDR,192.168.254.0/24,DIRECT,no-resolve
  
  # 3. –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (–ª–æ–∫–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã)
  - GEOIP,RU,DIRECT        # –†–æ—Å—Å–∏—è
  - GEOIP,UA,DIRECT        # –£–∫—Ä–∞–∏–Ω–∞
  - GEOIP,BY,DIRECT        # –ë–µ–ª–∞—Ä—É—Å—å
  - GEOIP,KZ,DIRECT        # –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω
  
  # 4. –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ RULE-SET
  - RULE-SET,meta_ips,üü¢ WhatsApp,no-resolve
  - RULE-SET,telegram_ips,üìÆ Telegram
  - RULE-SET,youtube_ips,‚ñ∂Ô∏è YouTube
  
  # 5. –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞
  - AND,((NETWORK,udp),(DST-PORT,443)),QUIC UDP 443
  - IN-NAME,tun-in,üöÄ AUTO-SELECT
  - IN-NAME,mixed-in,üöÄ AUTO-SELECT
  
  # 6. –§–∏–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç—Ä–∞—Ñ–∏–∫–∞, –¥–æ—à–µ–¥—à–µ–≥–æ –¥–æ Clash)
  - MATCH,üöÄ AUTO-SELECT